{"version":3,"file":"index.js","sources":["../src/index.tsx"],"sourcesContent":["import React, { RefObject, useEffect, useRef, useState } from 'react'\r\nimport AgoraRTC, {\r\n  BufferSourceAudioTrackInitConfig,\r\n  CameraVideoTrackInitConfig,\r\n  ClientConfig,\r\n  CustomAudioTrackInitConfig,\r\n  CustomVideoTrackInitConfig,\r\n  IAgoraRTCClient,\r\n  IBufferSourceAudioTrack,\r\n  ICameraVideoTrack,\r\n  ILocalAudioTrack,\r\n  ILocalVideoTrack,\r\n  IMicrophoneAudioTrack,\r\n  IRemoteVideoTrack,\r\n  MicrophoneAudioTrackInitConfig,\r\n  ScreenVideoTrackInitConfig\r\n} from 'agora-rtc-sdk-ng'\r\n\r\nexport default AgoraRTC;\r\nexport * from 'agora-rtc-sdk-ng';\r\n\r\nexport const createClient = (config: ClientConfig) => {\r\n  let client: IAgoraRTCClient\r\n  function createClosure() {\r\n    if (!client) {\r\n      client = AgoraRTC.createClient(config)\r\n    }\r\n    return client\r\n  }\r\n  return () => createClosure()\r\n}\r\n\r\nexport function createMicrophoneAndCameraTracks(\r\n  audioConfig?: MicrophoneAudioTrackInitConfig | undefined,\r\n  videoConfig?: CameraVideoTrackInitConfig | undefined\r\n) {\r\n  let tracks: [IMicrophoneAudioTrack, ICameraVideoTrack] | null = null\r\n  async function createClosure() {\r\n    tracks = await AgoraRTC.createMicrophoneAndCameraTracks(\r\n      audioConfig,\r\n      videoConfig\r\n    )\r\n    return tracks\r\n  }\r\n  return function useMicrophoneAndCameraTracks() {\r\n    const [ready, setReady] = useState(false)\r\n    const ref = useRef(tracks)\r\n\r\n    useEffect(() => {\r\n      if (ref.current === null) {\r\n        createClosure().then((tracks) => {\r\n          ref.current = tracks\r\n          setReady(true)\r\n        })\r\n      } else {\r\n        setReady(true)\r\n      }\r\n      return () => {\r\n        tracks = null\r\n      }\r\n    }, [])\r\n    return { ready, tracks: ref.current }\r\n  }\r\n}\r\n\r\nexport function createBufferSourceAudioTrack(\r\n  config: BufferSourceAudioTrackInitConfig\r\n) {\r\n  let track: IBufferSourceAudioTrack | null = null\r\n  async function createClosure() {\r\n    track = await AgoraRTC.createBufferSourceAudioTrack(config)\r\n    return track\r\n  }\r\n  return function useBufferSourceAudioTrack() {\r\n    const [ready, setReady] = useState(false)\r\n    const ref = useRef(track)\r\n\r\n    useEffect(() => {\r\n      if (ref.current === null) {\r\n        createClosure().then((track) => {\r\n          ref.current = track\r\n          setReady(true)\r\n        })\r\n      } else {\r\n        setReady(true)\r\n      }\r\n      return () => {\r\n        track = null\r\n      }\r\n    }, [])\r\n    return { ready, track: ref.current }\r\n  }\r\n}\r\n\r\nexport function createCameraVideoTrack(config?: CameraVideoTrackInitConfig) {\r\n  let track: ICameraVideoTrack | null = null\r\n  async function createClosure() {\r\n    track = await AgoraRTC.createCameraVideoTrack(config)\r\n    return track\r\n  }\r\n  return function useCameraVideoTrack() {\r\n    const [ready, setReady] = useState(false)\r\n    const ref = useRef(track)\r\n\r\n    useEffect(() => {\r\n      if (ref.current === null) {\r\n        createClosure().then((track) => {\r\n          ref.current = track\r\n          setReady(true)\r\n        })\r\n      } else {\r\n        setReady(true)\r\n      }\r\n      return () => {\r\n        track = null\r\n      }\r\n    }, [])\r\n    return { ready, track: ref.current }\r\n  }\r\n}\r\n\r\nexport function createCustomAudioTrack(config: CustomAudioTrackInitConfig) {\r\n  let track: ILocalAudioTrack | null = null\r\n  async function createClosure() {\r\n    track = await AgoraRTC.createCustomAudioTrack(config)\r\n    return track\r\n  }\r\n  return function useCustomAudioTrack() {\r\n    const [ready, setReady] = useState(false)\r\n    const ref = useRef(track)\r\n\r\n    useEffect(() => {\r\n      if (ref.current === null) {\r\n        createClosure().then((track) => {\r\n          ref.current = track\r\n          setReady(true)\r\n        })\r\n      } else {\r\n        setReady(true)\r\n      }\r\n      return () => {\r\n        track = null\r\n      }\r\n    }, [])\r\n    return { ready, track: ref.current }\r\n  }\r\n}\r\n\r\nexport function createCustomVideoTrack(config: CustomVideoTrackInitConfig) {\r\n  let track: ILocalVideoTrack | null = null\r\n  async function createClosure() {\r\n    track = await AgoraRTC.createCustomVideoTrack(config)\r\n    return track\r\n  }\r\n  return function useCustomVideoTrack() {\r\n    const [ready, setReady] = useState(false)\r\n    const ref = useRef(track)\r\n\r\n    useEffect(() => {\r\n      if (ref.current === null) {\r\n        createClosure().then((track) => {\r\n          ref.current = track\r\n          setReady(true)\r\n        })\r\n      } else {\r\n        setReady(true)\r\n      }\r\n      return () => {\r\n        track = null\r\n      }\r\n    }, [])\r\n    return { ready, track: ref.current }\r\n  }\r\n}\r\n\r\nexport function createMicrophoneAudioTrack(\r\n  config?: MicrophoneAudioTrackInitConfig\r\n) {\r\n  let track: IMicrophoneAudioTrack | null = null\r\n  async function createClosure() {\r\n    track = await AgoraRTC.createMicrophoneAudioTrack(config)\r\n    return track\r\n  }\r\n  return function useMicrophoneAudioTrack() {\r\n    const [ready, setReady] = useState(false)\r\n    const ref = useRef(track)\r\n\r\n    useEffect(() => {\r\n      if (ref.current === null) {\r\n        createClosure().then((track) => {\r\n          ref.current = track\r\n          setReady(true)\r\n        })\r\n      } else {\r\n        setReady(true)\r\n      }\r\n      return () => {\r\n        track = null\r\n      }\r\n    }, [])\r\n    return { ready, track: ref.current }\r\n  }\r\n}\r\n\r\nexport function createScreenVideoTrack(\r\n  config: ScreenVideoTrackInitConfig,\r\n  withAudio?: 'enable' | 'disable' | 'auto'\r\n) {\r\n  let tracks: [ILocalVideoTrack, ILocalAudioTrack] | ILocalVideoTrack\r\n  async function createClosure() {\r\n    tracks = await AgoraRTC.createScreenVideoTrack(config, withAudio)\r\n    return tracks\r\n  }\r\n  return function useScreenVideoTrack() {\r\n    const [ready, setReady] = useState(false)\r\n    const ref = useRef(tracks)\r\n\r\n    useEffect(() => {\r\n      if (ref.current === undefined) {\r\n        createClosure().then((tracks) => {\r\n          ref.current = tracks\r\n          setReady(true)\r\n        })\r\n      } else {\r\n        setReady(true)\r\n      }\r\n    }, [])\r\n    return { ready, tracks: ref.current }\r\n  }\r\n}\r\n\r\n\r\nexport const AgoraVideoPlayer = (props: React.DetailedHTMLProps<React.HTMLAttributes<HTMLDivElement>, HTMLDivElement> & { videoTrack: ILocalVideoTrack | IRemoteVideoTrack | ICameraVideoTrack }) => {\r\n  const vidDiv: RefObject<HTMLDivElement> = useRef(null)\r\n  const { videoTrack, ...other } = props;\r\n  useEffect(() => {\r\n    if (vidDiv.current !== null) videoTrack.play(vidDiv.current)\r\n    return () => {\r\n      videoTrack.stop()\r\n    }\r\n  }, [videoTrack])\r\n\r\n  return <div {...other} ref={vidDiv} />\r\n}\r\n"],"names":["createClient","config","client","createClosure","AgoraRTC","createMicrophoneAndCameraTracks","audioConfig","videoConfig","tracks","useMicrophoneAndCameraTracks","useState","ready","setReady","ref","useRef","useEffect","current","then","createBufferSourceAudioTrack","track","useBufferSourceAudioTrack","createCameraVideoTrack","useCameraVideoTrack","createCustomAudioTrack","useCustomAudioTrack","createCustomVideoTrack","useCustomVideoTrack","createMicrophoneAudioTrack","useMicrophoneAudioTrack","createScreenVideoTrack","withAudio","useScreenVideoTrack","undefined","AgoraVideoPlayer","props","vidDiv","videoTrack","other","play","stop","React"],"mappings":"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"}